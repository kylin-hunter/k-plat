spring:
  config:
    activate:
      on-profile: local
    import:
      - optional:nacos:plat-common.yaml
      - optional:nacos:plat-server-gateway-local.yaml
  cloud:
    nacos:
      config:
        server-addr: 127.0.0.1:8848
        namespace: local
      discovery:
        server-addr: 127.0.0.1:8848
        namespace: local
    gateway:
      discovery:
        locator:
          enabled: true
          lower-case-service-id: true
      routes:
        - id: url-proxy-1
          uri: lb://plat-server-core
          predicates:
            - Path=/k-plat/core/**
          filters:
            - StripPrefix=1
            - AddTrace
            - AddRequestHeader=K-FROM,plat-server-gateway
            - AddResponseHeader=K-FROM, plat-server-gateway
            - AddRequestParameter=K-FROM,plat-server-gateway
          metadata:
            connect-timeout: 10000 #ms
            response-timeout: 10000 #ms
        - id: url-proxy-2
          uri: lb://plat-server-core
          predicates:
            - Path=/kplat/core-proxy/**
          filters:
            - StripPrefix=1
            - AddTrace
            - AddRequestHeader=K-FROM,plat-server-gateway
            - AddResponseHeader=K-FROM, plat-server-gateway
            - AddRequestParameter=K-FROM,plat-server-gateway
            - SetRequestHeader=K-CLIENT, plat-server-gateway
            - PreserveHostHeader
            - RequestSize=200
            - RewritePath=/core-proxy/?(?<segment>.*), /core/$\{segment}
            - SaveSession
            - SecureHeaders

          metadata:
            connect-timeout: 10000 #ms
            response-timeout: 10000 #ms

